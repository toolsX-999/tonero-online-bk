<!doctype html>
<html lang="en">

<head>
    <title>ELTBank-Admin</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="/css/admin-dashboard.css">
    <link rel="stylesheet" href="/css/adminlogin.css">
    <link rel="icon" type="image/svg+xml" href="/images/bank-header-logo.svg">

</head>

<body>
    <!-- Top Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid ps-0 offcanvas-container">
            <!-- offcanvas trigger -->
            <button class="navbar-toggler ms-1" type="button" data-bs-toggle="offcanvas"
                data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- offcanvas trigger -->
            <!-- Brand logo -->
            <div class="d-flex align-items-center">
                <a href="/user/account"><img src="/images/admin-dashboard-logo.svg" alt="Bank Logo" class="logo" /></a>
            </div>

            <!--Brand logo  -->
            <!-- <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button> -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <form class="d-flex ms-auto">
                    <div class="input-group ms-1 me-sm-2 my-2">
                        <input type="text" class="form-control" placeholder="Search ..." aria-label="Search ..."
                            aria-describedby="button-addon2">
                        <button class="btn btn-primary" type="button" id="button-addon2"><span>
                                <i class="fas fa-search"></i>
                            </span></button>
                    </div>
                </form>
                <ul class="navbar-nav ms-2 mb-2 mb-lg-0">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <span><i class="fas fa-user-alt"></i></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item disabled" href="#">My Profile</a></li>
                            <li><a class="dropdown-item disabled" href="#">Account Settings</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="/admin/logout">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Top Navbar -->

    <!-- Side Navbar Offcanvas -->
    <!-- Setting data-bs-backdrop="false" prevents overlay effect on page when offcanvas is clicked -->
    <div class="offcanvas offcanvas-start side-navbar mt-lg-2 bg-dark text-white" tabindex="-1" id="offcanvasExample"
        aria-labelledby="offcanvasExampleLabel" data-bs-backdrop="false">
        <!-- <div class="offcanvas-header"> -->
        <!-- <h5 class="offcanvas-title" id="offcanvasExampleLabel">Offcanvas</h5> -->
        <!-- <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div> -->
        <div class="offcanvas-body p-0">
            <nav class="navbar-dark">
                <ul class="navbar-nav">
                    <li class="d-flex justify-content-between">
                        <div class="text-secondary small fw-bold text-uppercase px-3 pb-2 align-content-center">CORE
                        </div>
                        <div class="offcanvas-header close-canvas">
                            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                                aria-label="Close"></button>
                        </div>
                    </li>
                    <li>
                        <a href="#" class="text-decoration-none text-white active px-3">
                            <span class="me-2">
                                <i class="fas fa-dashboard"></i>
                            </span>
                            <span>
                                Dashboard
                            </span>
                        </a>
                    </li>
                    <li class="my-4">
                        <hr class="dropdown-divider">
                    </li>
                    <li>
                        <div class="text-secondary small fw-bold text-uppercase px-3">MANAGEMENT</div>
                    </li>
                    <li>
                        <a class="nav-link side-navbar-link px-3" href="#" role="button" aria-expanded="false"
                            aria-controls="collapseExample">
                            <span><i class="fas fa-shipping-fast	me-2"></i></span>
                            <span>Customers</span>
                        </a>
                    </li>
                    <li class="my-3">
                        <hr class="dropdown-divider">
                    </li>
                    <li>
                        <div class="text-secondary small fw-bold text-uppercase px-3">APPS</div>
                    </li>
                    <li>
                        <a class="nav-link side-navbar-link px-3 disabled" href="#" role="button" aria-expanded="false"
                            aria-controls="collapseExample">
                            <span><i class="fas fa-chart-line me-2"></i></span>
                            <span>Analytics</span>
                        </a>
                    </li>

                    <li>
                        <a class="nav-link side-navbar-link px-3 disabled" data-bs-toggle="collapse"
                            href="#collapseExample2" role="button" aria-expanded="false"
                            aria-controls="collapseExample2">
                            <span><i class="fab fa-rocketchat me-2"></i></span>
                            <span>Chats</span>
                            <!-- Push the fa-chevron-down icon to the right end with ms-auto-->
                            <span class="right-icon-chevron-down ms-auto"><i class="fas fa-chevron-down"></i></span>
                        </a>
                        <div class="collapse" id="collapseExample2">
                            <div>
                                <ul class="navbar-nav ps-3">
                                    <li>
                                        <a class="nav-link px-3" href="#">
                                            <span><i class="fas fa-user-friends me-2"></i></span>
                                            <span>Private Chat</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="nav-link px-3" href="#">
                                            <span><i class="fas fa-layer-group me-2"></i></span>
                                            <span>Group Chat</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="nav-link px-3" href="#">
                                            <span><i class="fab fa-snapchat-square me-2"></i></span>
                                            <span>Drawer Chat</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                    <li>
                        <a class="nav-link side-navbar-link px-3 disabled" href="#" role="button" aria-expanded="false"
                            aria-controls="collapseExample">
                            <span><i class="fas fa-folder me-2"></i></span>
                            <span>File Manager</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link side-navbar-link px-3 disabled" href="#" role="button" aria-expanded="false"
                            aria-controls="collapseExample">
                            <span><i class="fas fa-project-diagram	me-2"></i></span>
                            <span>Projects</span>
                        </a>
                    </li>
                    </li>
                    <li class="my-3">
                        <hr class="dropdown-divider">
                    </li>
                    <li>
                        <div class="text-secondary small fw-bold text-uppercase px-3">SETTINGS</div>
                    </li>
                    <li>
                        <a class="nav-link side-navbar-link px-3 disabled" data-bs-toggle="collapse"
                            href="#collapseExample3" role="button" aria-expanded="false"
                            aria-controls="collapseExample3">
                            <span><i class="fas fa-cog me-2"></i></span>
                            <span>System</span>
                            <!-- Push the fa-chevron-down icon to the right end with ms-auto-->
                            <span class="right-icon-chevron-down ms-auto"><i class="fas fa-chevron-down"></i></span>
                        </a>
                        <div class="collapse" id="collapseExample3">
                            <div>
                                <!-- <ul class="navbar-nav ps-3"> -->
                                <ul class="navbar-nav ps-3 mb-3">
                                    <li>
                                        <a class="nav-link px-3">
                                            <span><i class="fas fa-book-open me-2"></i></span>
                                            <span>Nested Link 1</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="nav-link px-3">
                                            <span><i class="fas fa-book-open me-2"></i></span>
                                            <span>Nested Link 2</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="nav-link px-3">
                                            <span><i class="fas fa-book-open me-2"></i></span>
                                            <span>Nested Link 3</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                    </li>
                    <li>
                        <a class="nav-link side-navbar-link px-3 disabled" href="/user/dashboard/users" role="button"
                            aria-expanded="false" aria-controls="collapseExample">
                            <span><i class="fas fa-shield-alt me-2"></i></span>
                            <span>Security</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link side-navbar-link px-3 disabled" href="/user/dashboard/users" role="button"
                            aria-expanded="false" aria-controls="collapseExample">
                            <span><i class="fas fa-wrench me-2"></i></span>
                            <span>Preferences</span>
                        </a>
                    </li>
                    <li class="my-3">
                        <hr class="dropdown-divider">
                    </li>
                    <li>
                        <div class="text-secondary small fw-bold text-uppercase px-3">HELP</div>
                    </li>
                    <li>
                        <a class="nav-link side-navbar-link px-3 disabled" href="/user/dashboard/users" role="button"
                            aria-expanded="false" aria-controls="collapseExample">
                            <span><i class="fas fa-question-circle me-2"></i></span>
                            <span>FAQ</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link side-navbar-link px-3 disabled" href="/user/dashboard/users" role="button"
                            aria-expanded="false" aria-controls="collapseExample">
                            <span><i class="fas fa-file-alt	me-2"></i></span>
                            <span>Documentations</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link side-navbar-link px-3 disabled" href="/user/dashboard/users" role="button"
                            aria-expanded="false" aria-controls="collapseExample">
                            <span><i class="fas fa-history me-2"></i></span>
                            <span>Changelog v1.0.0</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <!-- Side Navbar Offcanvas -->

    <!-- Main content -->
    <div class="container-fluid dashboard-content-area">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs mt-5">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" aria-current="page" href="#Customers"><i
                        class="fas fa-users me-1"></i>Customers</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#add-customer"><i class="fas fa-user-plus me-1"></i>Add
                    Customer</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#update-customer"><i class="fas fa-user-edit me-1"></i>Add
                    Account</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#set-otp-checkpoints"><i
                        class="fas fa-shield-alt me-1"></i>OTP Checkpoints</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#update-customer-photo"><i class="fas fa-sliders-h me-1"></i>Customize</a>
            </li>
            <li class="nav-item">
                <a class="nav-link disabled">Disabled</a>
            </li>
        </ul>
        <!-- Nav tabs -->
         
        <!-- Nav tab items -->
        <div class="tab-content my-4 p-2">
            <!-- Customers table -->
            <div class="tab-pane fade show active" id="Customers">
                <% if (users.length > 0) { %>
                <!-- Table -->
                <!-- Entries per page selector -->
                <div class="d-flex justify-content-between align-items-center m-2">
                    <label class="mb-0">
                        Show
                        <select id="entriesPerPage" class="form-select form-select-sm d-inline-block w-auto mx-1">
                            <option value="2">2</option>
                            <option value="5" selected>5</option>
                            <option value="10">10</option>
                            <option value="All">All</option>
                        </select>
                        entries
                    </label>
                </div>
                <!-- Table -->
                <div class="table-responsive">
                    <table class="table table-hover table-bordered align-middle" id="transactionTable">
                        <thead class="table-light">
                            <tr>
                                <th class="">Full Name</th>
                                <th class="">Email</th>
                                <th class="text-center">Created At</th>
                                <th class="text-center">Last login</th>
                                <th class="text-center">Account Status</th>
                                <th class="text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Add more rows here as needed -->
                            <% users.forEach(user => { %>
                                <tr>
                                    <td class=""><%= user.fullName %></td>
                                    <td class=""><%= user.email %></td>
                                    <td class="text-center">
                                        <%= new Date(user.createdAt ).toLocaleString('en-US',{
                                            year: 'numeric',
                                            month: 'short',
                                            day: 'numeric',
                                            hour: '2-digit',
                                            minute: '2-digit'
                                            }) %>
                                    </td>
                                    <td class="text-center">
                                        <%= new Date(user.lastLogin).toLocaleString('en-US',{
                                            year: 'numeric',
                                            month: 'short',
                                            day: 'numeric',
                                            hour: '2-digit',
                                            minute: '2-digit'
                                            }) %>
                                    </td>
                                    <td class="text-center text-danger"><%= user.status %></td>
                                    <td class="text-center">
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#customerDeleteModal-<%= user._id %>">
                                          <i class="fas fa-trash text-danger"></i>
                                        </a>
                                    </td>
                                    <!-- Delete Modal -->
                                    <div class="modal fade" id="customerDeleteModal-<%= user._id %>" tabindex="-1" aria-labelledby="customerDeleteLabel-<%= user._id %>" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5">Delete Customer</h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <!-- Alert -->
                                            <div id="deleteCustomerAlert-<%= user._id %>" class="alert alert-warning alert-dismissible fade show d-none" role="alert">
                                            <strong id="deleteCustomerAlertStatus-<%= user._id %>"></strong>
                                            <span id="deleteCustomerAlertMessage-<%= user._id %>"></span>
                                            <button type="button" class="btn" aria-label="Close" onclick="this.parentElement.classList.add('d-none')"></button>
                                            </div>
                                            Are you sure you want to delete (<%= user.fullName %>) from database? This action cannot be undone.
                                        </div>
                                        <div class="modal-footer">
                                            <form class="deleteCustomerForm" data-user-id="<%= user._id %>" action="<%= config.siteUrl %>/admin/delete/user/<%= user._id %>?_method=DELETE">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-danger">Delete</button>
                                            </form>
                                        </div>
                                        </div>
                                    </div>
                                    </div>
                                </tr>
                            <% }) %>
    
                            <!-- Add more rows for testing pagination -->
                        </tbody>
                    </table>
                </div>
                <!-- Pagination -->
                <nav>
                    <ul class="pagination justify-content-end mt-3" id="paginationContainer">
                        <!-- Pagination buttons inserted by JS -->
                    </ul>
                </nav>
                <!-- Table -->
                    <% } else { %>
                    <hr>
                    <div class="text-muted">
                        <i class="fas fa-folder-open fa-2x mb-2"></i>
                        <h5 class="mb-1">No customers Found</h5>
                        <p class="small">You haven’t created any customers yet.</p>
                    </div>
                <% } %>
            </div>

            <!-- Register/Create user -->
            <div class="tab-pane fade" id="add-customer">
                <div class="register-user login-box">
                    <!-- Text description card on top of the register/create customer form -->
                    <div class="p-4 mb-4 rounded shadow-sm bg-white border">
                        <h5 class="text-center text-muted mb-1">Register Customer</h5>
                        <p class="text-center text-muted small">Create your account in a few easy steps.</p>
                    </div>
                    
                    <!-- Alert success/failure div -->
                      <div id="formAlert" class="alert alert-dismissible fade d-none p-3" role="alert" style="background-color: aqua;">
                        <span id="alertMessage"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                      </div>
                    <!-- <form id="registerForm" action="/admin/register-user" method="POST" novalidate> -->
                    <form id="registerForm" action="<%= config.siteUrl %>/admin/register-user" method="POST">
                        <div class="mb-3">
                        <!-- <label for="username">Username</label> -->
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-user"></i></span>
                          <input type="text" class="form-control" id="fullname" name="fullname" placeholder="Enter fullname" required>
                        </div>
                        <div class="invalid-feedback">Please enter your fullname.</div>
                      </div>
                
                      <div class="mb-3">
                        <!-- <label for="username">Username</label> -->
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                          <input type="email" class="form-control" id="email" name="email" placeholder="Enter email" required>
                        </div>
                        <div class="invalid-feedback">Please enter your email.</div>
                      </div>
                
                      <div class="mb-3">
                        <!-- <label for="password">Password</label> -->
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-lock"></i></span>
                          <input type="password" class="form-control" id="password" name="password" placeholder="Enter password" required>
                          <span class="input-group-text toggle-password"><i class="fas fa-eye-slash" id="togglePasswordIcon"></i></span>
                        </div>
                        <div class="invalid-feedback">Please enter your password.</div>
                      </div>
                
                      <div class="mb-3">
                        <!-- <label for="confirm-password">Confirm Password</label> -->
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-lock"></i></span>
                          <input type="password" class="form-control" id="confirm-password" name="confirmPassword" placeholder="Confirm-password" required>
                          <span class="input-group-text toggle-confirm-password"><i class="fas fa-eye-slash" id="toggleConfirmPasswordIcon"></i></span>
                        </div>
                        <div class="invalid-feedback">Please enter confirm-password.</div>
                      </div>

                      <div class="mb-3">
                        <!-- <label for="username">Username</label> -->
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-phone"></i></span>
                          <input type="text" class="form-control" id="phoneNumber" name="phoneNumber" placeholder="Enter phone#. +1-675-8828-7373" required>
                        </div>
                        <div class="invalid-feedback">Please enter your telephone number.</div>
                      </div>
                
                      <div class="mb-3">
                        <!-- <label for="username">Username</label> -->
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-passport"></i></span>
                          <input type="text" class="form-control" id="passportNumber" name="passportNumber" placeholder="Enter passport number" required>
                        </div>
                        <div class="invalid-feedback">Please enter your passport number.</div>
                      </div>                

                      <div class="mb-3">
                        <!-- <label for="username">Username</label> -->
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                          <input type="text" class="form-control" id="address" name="address" placeholder="Enter full address" required>
                        </div>
                        <div class="invalid-feedback">Please enter your full address.</div>
                      </div>                
                
                      <div class="mb-3">
                        <!-- <label for="account-type">Account Type</label> -->
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-building-columns"></i></span>
                          <select class="form-select" id="account-typee" name="accountType" required>
                            <option selected disabled value="">Choose account type...</option>
                            <option value="checking">Checkings</option>
                            <option value="savings">Savings</option>
                            <option value="credit">Credit</option>
                        </select>
                
                        </div>
                        <div class="invalid-feedback">Please enter your account type.</div>
                      </div>
                
                      <div class="mb-3">
                        <!-- <label for="account-type">Routing number</label> -->
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
                          <input type="text" class="form-control" id="routing-number" name="routingNumber" placeholder="Enter routing number" required>
                        </div>
                        <div class="invalid-feedback">Please enter your routing number.</div>
                      </div>
                
                      <div class="mb-3">
                        <!-- <label for="account-number">Account Number</label> -->
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
                          <input type="text" class="form-control" id="account-number" name="accountNumber" placeholder="Enter account number" required>
                        </div>
                        <div class="invalid-feedback">Please enter account number.</div>
                      </div>
                
                      <div class="mb-3">
                        <!-- <label for="account-balance">Account Balance</label> -->
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-wallet"></i></span>
                          <input type="number" class="form-control" id="account-balance" name="accountBalance" placeholder="Enter account balance" required>
                        </div>
                        <div class="invalid-feedback">Please enter account balance.</div>
                      </div>
                
                      <div class="mb-3">
                        <!-- <label for="creation-date">Date of Creation(optional)</label> -->
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-calendar-check"></i></span>
                          <input type="date" class="form-control" id="creation-date" name="creationDate" placeholder="Enter account creation date">
                        </div>
                        <!-- <div class="invalid-feedback">Please enter account balance.</div> -->
                      </div>
                
                      <button class="btn btn-primary w-100" type="submit">Register</button>
                    </form>
                  </div>
                
                  <!-- Toast Notification -->
                  <div class="toast-container">
                    <div id="loginToast" class="toast align-items-center text-white bg-success border-0" role="alert">
                      <div class="d-flex">
                        <div class="toast-body">Registration successful!</div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                      </div>
                    </div>
                  </div>                
            </div>

            <!-- Update customer/Add account -->
            <div class="tab-pane fade" id="update-customer">
                <div class="update-user login-box">
                    <!-- Text description card on top of the customer update form -->
                    <div class="p-4 mb-4 rounded shadow-sm bg-white border">
                        <h5 class="text-center text-muted mb-1">Update Customer</h5>
                        <p class="text-center text-muted small">Add more accounts to an existing customer profile.</p>
                    </div>
                    <!-- Alert success/failure div -->
                    <div id="formAlert" class="alert alert-dismissible fade d-none p-3" role="alert"
                        style="background-color: aqua;">
                        <span id="alertMessage"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
            
                    <!-- <form id="updateForm" action="/admin/register-user" method="POST" novalidate> -->
                    <form id="updateForm">
                        <div class="mb-3">
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                <select class="form-select" id="update-user-select-id" name="user" required>
                                    <option selected disabled value="">Choose user to update...</option>
                                    <% users.forEach(user=> { %>
                                        <option value="<%= user._id %>">
                                            <%= user.fullName %>
                                        </option>
                                        <% }) %>
                                </select>
                            </div>
                            <div class="invalid-feedback">Please user to update.</div>
                        </div>
            
                        <div class="mb-3">
                            <!-- <label for="account-type">Account Type</label> -->
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-building-columns"></i></span>
                                <select class="form-select" id="update-user-account-type" name="accountType" required>
                                    <option selected disabled value="">Choose account type...</option>
                                    <!--<option value="checkings">Checkings</option>
                                    <option value="savings">Savings</option>
                                    <option value="credit">Credit</option> -->
                                </select>
                            </div>
                            <div class="invalid-feedback">Please enter your account type.</div>
                        </div>
            
                        <div class="mb-3">
                            <!-- <label for="account-type">Routing number</label> -->
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
                                <input type="text" class="form-control" id="update-user-routing-number" name="routingNumber"
                                    placeholder="Enter routing number" required>
                            </div>
                            <div class="invalid-feedback">Please enter your routing number.</div>
                        </div>
            
                        <div class="mb-3">
                            <!-- <label for="account-number">Account Number</label> -->
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
                                <input type="text" class="form-control" id="update-user-account-number" name="accountNumber"
                                    placeholder="Enter account number" required>
                            </div>
                            <div class="invalid-feedback">Please enter account number.</div>
                        </div>
            
                        <div class="mb-3">
                            <!-- <label for="account-balance">Account Balance</label> -->
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-wallet"></i></span>
                                <input type="number" class="form-control" id="update-account-balance-id" name="accountBalance"
                                    placeholder="Enter account balance" required>
                            </div>
                            <div class="invalid-feedback">Please enter account balance.</div>
                        </div>
            
                        <div class="mb-3">
                            <!-- <label for="creation-date">Date of Update(optional)</label> -->
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-calendar-check"></i></span>
                                <input type="date" class="form-control" id="update-date" name="updateDate"
                                    placeholder="Enter account update date">
                            </div>
                            <!-- <div class="invalid-feedback">Please enter account balance.</div> -->
                        </div>
            
                        <button class="btn btn-primary w-100" type="submit">Update Account</button>
                    </form>
                </div>
            
                <!-- Toast Notification -->
                <div class="toast-container">
                    <div id="loginToast" class="toast align-items-center text-white bg-success border-0" role="alert">
                        <div class="d-flex">
                            <div class="toast-body">Registration successful!</div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                </div>            
            </div>

            <!-- Set OTP Checkpoints -->
            <div class="tab-pane fade" id="set-otp-checkpoints">
                <div class="login-box">
                    <!-- Text description card on top of the set OTP checkpoints form -->
                    <div class="p-4 mb-4 rounded shadow-sm bg-white border">
                        <h5 class="text-center text-muted mb-1">Set OTP Checkpoints</h5>
                        <p class="text-center text-muted small">Set/Remove OTP checkpoints with unique names per customer.</p>
                    </div>
                    <!-- <h4 class="login-title">Bank Login</h4> -->
                
                    <!-- Alert success/failure div -->
                    <div id="formAlert" class="alert alert-dismissible fade d-none p-3" role="alert" style="background-color: aqua;">
                      <span id="alertMessage"></span>
                      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                
                
                    <!-- <form id="setOtpForm" action="/admin/set-otp" method="POST" novalidate> -->
                    <form id="setOtpForm" action="<%= config.siteUrl %>/admin/set-otp" method="POST">
                      <div class="mb-3">
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-user"></i></span>
                          <select class="form-select" id="set-otp-form-id" name="user" required>
                            <option selected disabled value="">Choose user to update</option>
                            <% users.forEach(user=> { %>
                              <option value="<%= user._id %>">
                                <%= user.fullName %>
                              </option>
                              <% }) %>
                          </select>
                        </div>
                        <div class="invalid-feedback">Please user to update.</div>
                      </div>
                
                      <div class="mb-3">
                        <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-toggle-on text-success"></i></span>
                        <select class="form-select" name="enableDisableOtp">
                          <option selected disabled value="">Choose enable/disable otp</option>
                          <option value="enable">Enable</option>
                          <option value="disable">Disable</option>
                        </select>
                        </div>
                      </div>
                
                      <div class="mb-3">
                        <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-exchange-alt"></i></span>
                        <select class="form-select" name="transactionType">
                          <option selected disabled value="">Choose transaction type</option>
                          <option value="deposit">Deposit</option>
                          <option value="transfer">Transfer</option>
                          <option value="withdrawal">Withdrawal</option>
                        </select>
                        </div>
                      </div>
                
                
                      <div class="mb-3">
                        <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                        <select class="form-select" name="otpLevel">
                          <!-- <option value="0">0 - No OTP Required</option> -->
                          <option selected disabled value="">Choose # of otps required</option>
                          <option value="1">1 - OTP Required Once</option>
                          <option value="multiple">Custom - Multiple Checkpoints</option>
                        </select>
                        </div>
                      </div>
                     
                      <div class="mb-3">
                        <!-- <label for="checkpoints" class="form-label">Custom Checkpoints (%)</label> -->
                        <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-signal"></i></span>
                        <input type="text" class="form-control" id="checkpoints" name="checkpoints" placeholder="Checkpoint EX. 40,75,90">
                        <small class="text-muted text-center">If level is 'Custom'. Separate values with commas.</small>
                      </div>
                      </div>
                
                      <div class="mb-3">
                        <!-- <label for="checkpoints" class="form-label">Custom Checkpoints (%)</label> -->
                        <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-key"></i></span>
                        <input type="text" class="form-control" id="codes" name="codes" placeholder="OTP EX. 11AB,1212,9090">
                        <small class="text-muted text-center">If level is 'Custom'. Separate values with commas.</small>
                      </div>
                      </div>
                
                      <div class="mb-3">
                        <!-- <label for="checkpoints" class="form-label">Custom Checkpoints (%)</label> -->
                        <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-sms"></i></span>
                        <input type="text" class="form-control" id="otpMsgs" name="otpMsgs" placeholder="OTP msgs EX. C.O.T,C.O.W,C.O.D">
                        <small class="text-muted text-center">If level is 'Custom'. Separate values with commas.</small>
                      </div>
                      </div>
                
                      <div class="mb-3">
                        <!-- <label for="deliveryMode" class="form-label">OTP Delivery</label> -->
                        <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-mobile-alt"></i></span>
                        <select class="form-select" id="deliveryMode" name="deliveryMode">
                          <option value="manual">Manual (Admin Sends Code)</option>
                          <option value="email">Auto (OTP via Email)</option>
                          <option value="sms">Auto (OTP via SMS)</option>
                        </select>
                      </div>
                      </div>
                
                      <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Save Settings</button>
                      </div>
                      <!-- <button class="btn btn-primary w-100" type="submit">Update Account</button> -->
                    </form>
                  </div>
                
                  <!-- Toast Notification -->
                  <div class="toast-container">
                    <div id="loginToast" class="toast align-items-center text-white bg-success border-0" role="alert">
                      <div class="d-flex">
                        <div class="toast-body">Settings!</div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                      </div>
                    </div>
                  </div>                
            </div>

            <!-- Upload Profile Photo -->
            <div class="tab-pane fade" id="update-customer-photo">
                    <div class="update-user login-box">
                        <!-- Text description card on top of the customer update form -->
                        <div class="p-4 mb-4 rounded shadow-sm bg-white border">
                            <h5 class="text-center text-muted mb-1">Add profile photo</h5>
                            <p class="text-center text-muted small">Add profile photo to a customers account.</p>
                        </div>
                        <!-- Alert success/failure div -->
                        <div id="formAlertImageUpload" class="alert alert-dismissible fade show d-none p-3" role="alert"
                            style="background-color: aqua;">
                            <span id="alertMessageImageUpload"></span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        <!-- <form id="Add profile image" novalidate> -->
                        <form id="updateFormCustomerPhoto" action="<%= config.siteUrl %>/admin/upload-profile-photo?_method=PUT" method="post" enctype="multipart/form-data">
                            <div class="mb-3">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                                    <select class="form-select" id="update-customer-photo-id" name="user" required>
                                        <option selected disabled value="">Choose user to update...</option>
                                        <% users.forEach(user=> { %>
                                            <option value="<%= user._id %>">
                                                <%= user.fullName %>
                                            </option>
                                            <% }) %>
                                    </select>
                                </div>
                                <div class="invalid-feedback">Please user to update.</div>
                            </div>
                            <div class="mb-3">
                                <div class="input-group">
                                  <span class="input-group-text"><i class="fas fa-file-image"></i></span>
                                  <input type="file" class="form-control" id="image-input-id" name="profileImage" accept="image/*">
                                </div>
                                <!-- ✅ Image Preview Element -->
                                <img id="previewImg" src="#" alt="Preview" class="img-thumbnail mt-2"
                                     style="width: 100%; height: auto; object-fit: cover; display: none;">
                              </div>
                            <button class="btn btn-primary w-100" type="submit">Update Account</button>
                        </form>
                    </div>
                
                    <!-- Toast Notification -->
                    <div class="toast-container">
                        <div id="addPhotoToast" class="toast align-items-center text-white bg-success border-0" role="alert">
                            <div class="d-flex">
                                <div class="toast-body">Update successful!</div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                            </div>
                        </div>
                    </div>            
            </div>

        </div>
        <!-- Nav tab items -->
    </div>
    <!-- Main content -->

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

    <!-- Make .env variables available via middleware in server.js -->
    <script>
        const config = {
        siteUrl: "<%= config.siteUrl %>"
        };
    //   console.log("Config in js script from .env = ", config);
    </script>

    <!-- Enables url changes during tab switching and preserves page on reload -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const hash = window.location.hash;
            if (hash) {
                const tabTrigger = document.querySelector(`a[href="${hash}"]`);
                if (tabTrigger) {
                    new bootstrap.Tab(tabTrigger).show();
                }
            }

            // Update URL hash when a tab is shown
            const tabLinks = document.querySelectorAll('a[data-bs-toggle="tab"]');
            tabLinks.forEach(link => {
                link.addEventListener('shown.bs.tab', function (e) {
                    const targetId = e.target.getAttribute("href");
                    history.pushState(null, null, targetId);
                });
            });
        });
    </script>

    <!-- Account Overview Table pagination -->
    <script>
        const table = document.getElementById("transactionTable");
        const rows = table? Array.from(table.querySelectorAll("tbody tr")) : [];
        const paginationContainer = document.getElementById("paginationContainer");
        const entriesSelect = document.getElementById("entriesPerPage");

        let currentPage = 1;
        let entriesPerPage = parseInt(entriesSelect?.value) || 10;

        function renderPagination(totalPages) {
            if (!paginationContainer) return;
            paginationContainer.innerHTML = "";

            const createPageItem = (label, page, disabled = false, active = false) => {
                const li = document.createElement("li");
                li.className = `page-item${disabled ? ' disabled' : ''}${active ? ' active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#">${label}</a>`;
                li.addEventListener("click", e => {
                    e.preventDefault();
                    if (!disabled && currentPage !== page) {
                        currentPage = page;
                        renderTable();
                    }
                });
                return li;
            };

            const total = Math.ceil(rows.length / entriesPerPage);
            paginationContainer.appendChild(createPageItem("Previous", currentPage - 1, currentPage === 1));

            for (let i = 1; i <= total; i++) {
                paginationContainer.appendChild(createPageItem(i, i, false, currentPage === i));
            }

            paginationContainer.appendChild(createPageItem("Next", currentPage + 1, currentPage === total));
        }

        function renderTable() {
            const start = (currentPage - 1) * entriesPerPage;
            const end = start + entriesPerPage;

            rows.forEach((row, index) => {
                row.style.display = entriesPerPage === "All" ? "" : (index >= start && index < end ? "" : "none");
            });

            if (entriesPerPage === "All") {
                paginationContainer.innerHTML = "";
            } else {
                renderPagination(Math.ceil(rows.length / entriesPerPage));
            }
        }

        if (entriesSelect) {
            entriesSelect.addEventListener("change", () => {
                const val = entriesSelect.value;
                entriesPerPage = val === "All" ? "All" : parseInt(val);
                currentPage = 1;
                renderTable();
            });
        }

        // Initial render
        renderTable();
    </script>

    <!-- Add user -->
    <script>
        // Toggle Password Visibility
        const togglePassword = document.querySelector(".toggle-password");
        const passwordInput = document.getElementById("password");
        const passwordIcon = document.getElementById("togglePasswordIcon");

        const toggleConfirmPassword = document.querySelector(".toggle-confirm-password");
        const confirmPasswordInput = document.getElementById("confirm-password");
        const confirmPasswordIcon = document.getElementById("toggleConfirmPasswordIcon");

        const alertBox = document.getElementById("formAlert");

        togglePassword.addEventListener("click", () => {
        const type = passwordInput.type === "password" ? "text" : "password";
        passwordInput.type = type;
        passwordIcon.classList.toggle("fa-eye");
        passwordIcon.classList.toggle("fa-eye-slash");
        });

        toggleConfirmPassword.addEventListener("click", () => {
        const type = confirmPasswordInput.type === "password" ? "text" : "password";
        confirmPasswordInput.type = type;
        confirmPasswordIcon.classList.toggle("fa-eye");
        confirmPasswordIcon.classList.toggle("fa-eye-slash");
        });


        // Form Validation and Toast
        const form = document.getElementById("registerForm");
        const toast = new bootstrap.Toast(document.getElementById("loginToast"));

        form.addEventListener("submit", async function (e) {
        e.preventDefault();
        //   If errors
        if (!form.checkValidity()) {
            e.stopPropagation();
            form.classList.add("was-validated");
            return;
        }

        const formData = new FormData(form);
        const payload = Object.fromEntries(formData.entries());
        try {
            const response = await fetch(form.action, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
            });

            const result = await response.json();

            // alertBox.classList.remove('d-none', 'alert-danger', 'alert-success');
            // alertBox.classList.add(response.ok ? 'alert-success' : 'alert-danger');
            // alertBox.textContent = result.message || (response.ok ? 'Success' : 'Error occurred');
            alertBox.classList.remove('d-none', 'alert-danger', 'alert-success');
            alertBox.classList.add('show', response.ok ? 'alert-success' : 'alert-danger');
            document.getElementById('alertMessage').textContent = result.message || (response.ok ? 'Success' : 'Error occurred');


            if (response.ok) {
            // toast.show();
            form.classList.remove("was-validated");
            form.reset();
        }
        } catch (err) {
            alertBox.classList.remove('d-none', 'alert-success');
            alertBox.classList.add('alert-danger');
            alertBox.textContent = 'Network or server error.';
            }
        });

        // Dark mode toggle
        function toggleTheme() {
        document.documentElement.classList.toggle("dark-mode");
        }
    </script>

    <!-- ===================================================================================== -->
    <!-- Update User/Add account Display only account types not assigned to users in dropdown -->
    <script>
        document.getElementById("update-user-select-id").addEventListener("change", async function () {
            userId = this.value;
            const accountTypeSelect = document.getElementById("update-user-account-type");
            // accountTypeSelect.innerHTML = `
            // <option selected disabled value="">Choose account type...</option>
            // `;
            try {
                const res = await fetch(`${config.siteUrl}/admin/user-missing-accounts/${userId}`);
                const data = await res.json();
                

                data.missingTypes.forEach(type => {
                    const label = type.charAt(0).toUpperCase() + type.slice(1); // Capitalize
                    const opt = document.createElement("option");
                    opt.value = type;
                    opt.textContent = label;
                    accountTypeSelect.appendChild(opt);
                });
            } catch (err) {
                console.error("Error fetching account types:", err);
            }
        });
    </script>
    
    <!-- Update user account -->
    <script>
        document.getElementById("updateForm").addEventListener("submit", async function (e) {
            e.preventDefault();
            const form = e.target;
            const userId = document.getElementById("update-user-select-id").value;
            const formData = new FormData(form);
            const payload = Object.fromEntries(formData.entries());

            try {
                const res = await fetch(`${config.siteUrl}/admin/update-user/${userId}?_method=PUT`, {
                    method: "POST",
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await res.json();

                if (res.ok) {
                    alert(result.message || "Account updated successfully!");
                    form.reset();
                    // window.location.href = "/admin/dashboard#update-customer";
                } else {
                    alert(result.error || "Failed to update account.");
                }
            } catch (err) {
                console.error("Error submitting form:", err);
                alert("Something went wrong. Please try again.");
            }
        });
    </script>
    <!-- ===================================================================================== -->

    <!-- Set OTP Checkpoints -->
    <script>
        document.getElementById("set-otp-form-id").addEventListener("change", async function () {
        userId = this.value;
        const accountTypeSelect = document.getElementById("account-type");

        accountTypeSelect.innerHTML = `
                <option selected disabled value="">Choose account type...</option>
                `;
        try {
            const res = await fetch(`${config.siteUrl}/admin/user-missing-accounts/${userId}`);
            const data = await res.json();

            data.missingTypes.forEach(type => {
            const label = type.charAt(0).toUpperCase() + type.slice(1); // Capitalize
            const opt = document.createElement("option");
            opt.value = type;
            opt.textContent = label;
            accountTypeSelect.appendChild(opt);
            });
        } catch (err) {
            console.error("Error fetching account types:", err);
        }
        });
    </script>

    <!-- Save setting -->
    <script>
        document.getElementById("setOtpForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        const form = e.target;
        const userId = document.getElementById("set-otp-form-id").value;
        const formData = new FormData(form);
        const payload = Object.fromEntries(formData.entries());
        try {
            const res = await fetch(`${config.siteUrl}/admin/set-otp?_method=PUT`, {
            method: "POST",
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
            });

            const result = await res.json();

            if (res.ok) {
            alert(result.message || "Account updated successfully!");
            // window.location.href = `${config.siteUrl}/admin/set-otp`;
            } else {
            alert(result.error || "Failed to update account.");
            }
        } catch (err) {
            console.error("Error submitting form:", err);
            alert("Something went wrong. Please try again.");
        }
        });
    </script>
    <!-- Scripts -->

    <!-- Delete customer from table -->
    <script>
        document.querySelectorAll('.deleteCustomerForm').forEach(form => {
            form.addEventListener('submit', async function (e) {
            e.preventDefault();
        
            const customerId = this.dataset.userId;
            
            const action = this.getAttribute('action');
        
            const alertBox = document.getElementById(`deleteCustomerAlert-${customerId}`);
            const alertStatus = document.getElementById(`deleteCustomerAlertStatus-${customerId}`);
            const alertMessage = document.getElementById(`deleteCustomerAlertMessage-${customerId}`);
        
            try {
                const res = await fetch(action, {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json"
                }
                });
        
                const result = await res.json();
        
                alertBox.classList.remove("d-none", "alert-danger");
                alertBox.classList.add("alert-success");
                alertStatus.textContent = `${result.status}: `;
                alertMessage.textContent = result.message;
        
                // 🧹 Remove the row from the table
                const row = document.getElementById(`customerRow-${customerId}`);
                if (row) row.remove();
        
                // 🕒 Auto-hide alert
                setTimeout(() => {
                alertBox.classList.add("d-none");
                }, 8000);
        
                // 🕓 Close modal after short delay
                setTimeout(() => {
                const modal = bootstrap.Modal.getInstance(document.getElementById(`customerDeleteModal-${customerId}`));
                modal.hide();
                }, 1000);
        
            } catch (error) {
                alertBox.classList.remove("d-none", "alert-success");
                alertBox.classList.add("alert-danger");
                alertStatus.textContent = `Error: `;
                alertMessage.textContent = "Failed to delete customer.";
        
                setTimeout(() => {
                alertBox.classList.add("d-none");
                }, 5000);
            }
            });
        });
    </script>    

    <!-- Upload profile photo -->
    <script>
        document.getElementById("image-input-id").addEventListener("change", function (e) {
        const preview = document.getElementById("previewImg");
        const file = e.target.files[0];
        if (file) {
            preview.src = URL.createObjectURL(file);
            preview.style.display = "block";
        }
        });

        document.getElementById("updateFormCustomerPhoto").addEventListener("submit", async function (e) {
          e.preventDefault();
        
          const form = e.target;
          const formData = new FormData(form);
        
          try {
            const response = await fetch(form.action, {
              method: 'POST',
              body: formData,
            });
        
            const result = await response.json();
            // console.log("Result from FE ", result);
             
            const alertBox = document.getElementById("formAlertImageUpload");
            const alertMessage = document.getElementById("alertMessageImageUpload");
        
            alertBox.classList.remove('d-none', 'alert-danger', 'alert-success');
            alertBox.classList.add(response.ok ? 'alert-success' : 'alert-danger');
            alertMessage.textContent = result.message || (response.ok ? 'Success' : 'Failed');
        
            if (response.ok && result.imageUrl) {
            // console.log("imageUrl in FE = ", result.imageUrl);
              const preview = document.getElementById("previewImg");
              preview.src = result.imageUrl;
              preview.style.display = "block";
            }
          } catch (err) {
            const alertBox = document.getElementById("formAlertImageUpload");
            alertBox.classList.remove('d-none', 'alert-success');
            alertBox.classList.add('alert-danger');
            document.getElementById("alertMessageImageUpload").textContent = 'Network error.';
          }
        });
    </script>        


</body>

</html>