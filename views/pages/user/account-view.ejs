<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ELTBank-Online Banking</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="icon" type="image/svg+xml" href="/images/bank-header-logo.svg">
    <link rel="stylesheet" href="/css/account-view.css">
</head>

<body>
    <!-- Header -->
    <div class="" style="position: fixed; width: 100%; background-color: #a4c639; z-index: 2; top: 0;">
        <div class="content-header d-flex align-items-center px-3 py-3 justify-content-between">
            <div class="d-flex align-items-center">
                <a href="/user/account"><img src="/images/bank-logo.svg" alt="Bank Logo" class="logo" /></a>
            </div>

            <!-- Mobile toggle button -->
            <button class="btn btn-outline-secondary d-md-none" type="button" data-bs-toggle="offcanvas"
                data-bs-target="#sidebarOffcanvas" aria-controls="sidebarOffcanvas">
                â˜°
            </button>
        </div>
    </div>

    <!-- Topbar -->
    <div class="topbar border" style="position: fixed; width: 100%; z-index: 2;">
        <a href="/user/account" title="Refresh">ðŸ”„</a> |
        <a href="#">Locations</a> |
        <a href="#">Help</a> |
        <a href="#">Mail</a> |
        <a href="/user/logout" class="text-danger fw-bold">Sign Off</a>
    </div>

    <div class="container-fluid" style="margin-top: 70px;">
        <div class="row flex-column flex-md-row">
            <!-- Sidebar (Offcanvas on small screens) -->
            <nav class="col-md-2 sidebar d-none d-md-block border border-top-0">
                <div class="greet-user border rounded p-3">
                    <b class="">Welcome, <%= userFullname %></b>
                    <p class="" style="text-decoration: underline; margin-top: 8px;">
                        <span><a href="#" class="p-0">Edit profile</a></span>
                </div>
                <a href="/user/account" class="active nav-link-item" onclick="switchView('overview')"
                    data-bs-toggle="tooltip" title="Account Overview">
                    <i class="fas fa-building-columns me-2 nav-icon"></i> <span class="nav-text">Account Overview</span>
                </a>
                <a href="#" class="nav-link-item" onclick="switchView('transfer')" data-bs-toggle="tooltip"
                    title="Online Transfer">
                    <i class="fas fa-exchange-alt me-2 nav-icon"></i> <span class="nav-text">Online Transfer</span>
                </a>
                <a href="#" class="nav-link-item" onclick="switchView('quickpay')" data-bs-toggle="tooltip"
                    title="Quick Pay">
                    <i class="fas fa-wallet me-2 nav-icon"></i> <span class="nav-text">Quick Payments</span>
                </a>
                <a href="#" class="nav-link-item" onclick="switchView('recurring')" data-bs-toggle="tooltip"
                    title="Recurring Transfer">
                    <i class="fas fa-calendar-alt me-2 nav-icon"></i> <span class="nav-text">Recurring Pays</span>
                </a>
                <a href="#" class="nav-link-item" onclick="switchView('pending')" data-bs-toggle="tooltip"
                    title="Pending Payments">
                    <i class="fas fa-clock me-2 nav-icon"></i> <span class="nav-text">Pending Payments</span>
                </a>
                <a href="#" class="nav-link-item" onclick="switchView('history')" data-bs-toggle="tooltip"
                    title="Payment History">
                    <i class="fas fa-receipt me-2 nav-icon"></i> <span class="nav-text">Payment History</span>
                </a>
                <a href="#" class="nav-link-item" onclick="switchView('add-merchant')" data-bs-toggle="tooltip"
                    title="Add Merchant">
                    <i class="fas fa-building me-2 nav-icon"></i> <span class="nav-text">Add Merchant</span>
                </a>
                <a href="#" class="nav-link-item" onclick="switchView('delete-merchant')" data-bs-toggle="tooltip"
                    title="Delete Merchant">
                    <i class="fas fa-trash-alt me-2 nav-icon"></i> <span class="nav-text">Delete Merchant</span>
                </a>
                <a href="#" class="nav-link-item" onclick="switchView('customer-service')" data-bs-toggle="tooltip"
                    title="Customer Service">
                    <i class="fas fa-headset me-1 nav-icon"></i> <span class="nav-text">Customer Service</span>
                </a>
                <a href="#" class="nav-link-item" onclick="switchView('profile')" data-bs-toggle="tooltip"
                    title="Profile view">
                    <i class="fas fa-user-cog me-1 nav-icon"></i> <span class="nav-text">Profile View</span>
                </a>
            </nav>

            <!-- Offcanvas version of sidebar for small screens -->
            <div class="offcanvas offcanvas-start d-md-none" tabindex="-1" id="sidebarOffcanvas"
                aria-labelledby="sidebarOffcanvasLabel">
                <div class="offcanvas-header border">
                    <h5 class="offcanvas-title" id="sidebarOffcanvasLabel">Menu</h5>
                    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close">
                    </button>
                </div>
                <div class="offcanvas-body sidebar border border-top-0">
                    <a href="#" class="active" onclick="switchView('overview')" data-bs-dismiss="offcanvas">
                        <i class="fas fa-building-columns me-2"></i> Account Overview
                    </a>
                    <a href="#" onclick="switchView('transfer')" data-bs-dismiss="offcanvas">
                        <i class="fas fa-exchange-alt me-2"></i> Transfer Payment
                    </a>
                    <a href="#" onclick="switchView('quickpay')" data-bs-dismiss="offcanvas">
                        <i class="fas fa-wallet me-2"></i> Quick Pay
                    </a>
                    <a href="#" onclick="switchView('recurring')" data-bs-dismiss="offcanvas">
                        <i class="fas fa-calendar-alt me-2"></i> Recurring Pays
                    </a>
                    <a href="#" onclick="switchView('pending')" data-bs-dismiss="offcanvas">
                        <i class="fas fa-clock me-2"></i> Pending Payments
                    </a>
                    <a href="#" onclick="switchView('history')" data-bs-dismiss="offcanvas">
                        <i class="fas fa-receipt me-2"></i> Payment History
                    </a>
                    <a href="#" onclick="switchView('add-merchant')" data-bs-dismiss="offcanvas">
                        <i class="fas fa-building me-2"></i> Add Merchant
                    </a>
                    <a href="#" onclick="switchView('delete-merchant')" data-bs-dismiss="offcanvas">
                        <i class="fas fa-trash-alt me-2"></i> Delete Merchant
                    </a>
                    <a href="#" onclick="switchView('customer-service')" data-bs-dismiss="offcanvas">
                        <i class="fas fa-headset me-1"></i> Customer Service
                    </a>
                    <a href="#" onclick="switchView('profile')" data-bs-dismiss="offcanvas">
                        <i class="fas fa-user-cog me-1"></i> Profile View
                    </a>
                </div>
            </div>

            <!-- Main Content -->
            <main class="col-md-10 px-4 py-3" id="main-content" style="position: absolute; right: 0; margin-top: 35px;">
                <!-- Account Overview -->
                <div id="overview-view">
                    <h4 class="mb-4 fw-bold text-secondary"
                        style="font-size: 1.25rem; letter-spacing: 0.3px; margin-top: 12px;">
                        <i class="fas fa-wallet me-2 text-muted"></i>Overview
                    </h4>
                    <!-- Account Selector -->
                    <ul class="nav nav-tabs mb-4" id="accountTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="checking-tab" data-bs-toggle="tab"
                                data-bs-target="#checking" type="button" role="tab" aria-controls="checking"
                                aria-selected="true">
                                Checking Account
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="savings-tab" data-bs-toggle="tab" data-bs-target="#savings"
                                type="button" role="tab" aria-controls="savings" aria-selected="false">
                                Savings Account
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="credit-tab" data-bs-toggle="tab" data-bs-target="#credit"
                                type="button" role="tab" aria-controls="credit" aria-selected="false">
                                Credit Card
                            </button>
                        </li>
                    </ul>

                    <!-- Account Details -->
                    <div class="tab-content px-2" id="accountTabsContent">
                        <!-- Checking Account -->
                        <div class="tab-pane fade show active" id="checking" role="tabpanel"
                            aria-labelledby="checking-tab">
                            <!-- Latest transactions -->
                            <% let latestCheckingsTx=transactions .filter(tx=> account.find(acc => acc.accountNumber ===
                                tx.fromAccount)?.accountType === "checking")
                                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))[0];

                                let latestSavingsTx = transactions
                                .filter(tx => account.find(acc => acc.accountNumber === tx.fromAccount)?.accountType ===
                                "savings")
                                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))[0];

                                let latestCreditTx = transactions
                                .filter(tx => account.find(acc => acc.accountNumber === tx.fromAccount)?.accountType ===
                                "credit")
                                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))[0];
                                %>
                                <!--  -->
                                <div class="row">
                                    <div class="col-sm-6 card shadow-sm mb-3 rounded px-2">
                                        <div class="card-body">
                                            <h5 class="card-title mb-2 fw-semibold text-primary-emphasis"
                                                style="font-size: 1rem;">
                                                EliteTrust-Bank<sup>Â®</sup><span
                                                    class="badge bg-light text-dark ms-1">Checkings</span>
                                            </h5>
                                            <p class="card-text"><strong>Account Number:</strong>
                                                <% const checkingAccounts=account.find(acc=> acc.accountType ===
                                                    "checking"); %>
                                                    <%= checkingAccounts ? checkingAccounts.accountNumber
                                                        : "No checkings account" %>
                                            </p>
                                            <p class="card-text"><strong>Available Balance:</strong>
                                                <% const checkingsAccountBal=account.find(acc=> acc.accountType ===
                                                    "checking"); %>
                                                    $<%= checkingsAccountBal ? checkingsAccountBal.balance.toFixed(2)
                                                        : "0.00" %>
                                            </p>
                                            <p class="card-text"><strong>Recent Transaction:</strong>
                                                <%= latestCheckingsTx && latestCheckingsTx.remarks &&
                                                    latestCheckingsTx.amount ? latestCheckingsTx.remarks + ' -$' +
                                                    latestCheckingsTx.amount.toFixed(2) : " N/A" %>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 card shadow-sm mb-3 border-0 rounded-0 px-2"
                                        style="height: auto;">
                                        <div class="card-body">
                                            <!-- <h5 class="card-title">Bank of America Checking</h5> -->
                                            <!-- <p class="card-text fw-bold ms-1">Customized Cash Rewards</p> -->
                                            <img src="/images/cropped1.png" alt="" class="img-fluid w-50 rounded">
                                            <!-- <p class="ms-1"><span style="color: red;">$200</span> online bonus offer</p> -->
                                        </div>
                                    </div>
                                </div>
                        </div>

                        <!-- Savings Account -->
                        <div class="tab-pane fade" id="savings" role="tabpanel" aria-labelledby="savings-tab">
                            <div class="row">
                                <div class="col-sm-6 card shadow-sm mb-3 rounded px-2">
                                    <div class="card-body">
                                        <h5 class="card-title mb-2 fw-semibold text-primary-emphasis"
                                            style="font-size: 1rem;">
                                            EliteTrust-Bank<sup>Â®</sup><span
                                                class="badge bg-light text-dark ms-1">Savings</span>
                                        </h5>
                                        <p class="card-text"><strong>Account Number:</strong>
                                            <% const savingsAccount=account.find(acc=> acc.accountType === "savings");
                                                %>
                                                <%= savingsAccount ? savingsAccount.accountNumber : "No savings account"
                                                    %>
                                        </p>
                                        <p class="card-text"><strong>Available Balance:</strong>
                                            <% const savingsAccountBal=account.find(acc=> acc.accountType ===
                                                "savings"); %>
                                                $<%= savingsAccountBal ? savingsAccountBal.balance.toFixed(2) : "0.00"
                                                    %>
                                        </p>
                                        <p class="card-text"><strong>Recent Transaction:</strong>
                                            <%= latestSavingsTx && latestSavingsTx.remarks && latestSavingsTx.amount ?
                                                latestSavingsTx.remarks + ' -$' + latestSavingsTx.amount.toFixed(2)
                                                : " N/A" %>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-sm-6 card shadow-sm mb-3 border-0 rounded-0" style="height: auto;">
                                    <div class="card-body">
                                        <!-- <h5 class="card-title">Bank of America Checking</h5> -->
                                        <!-- <p class="card-text fw-bold ms-1">Customized Cash Rewards</p> -->
                                        <img src="/images/cropped1.png" alt="" class="img-fluid w-50 rounded">
                                        <!-- <p class="ms-1"><span style="color: red;">$200</span> online bonus offer</p> -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Credit Card -->
                        <div class="tab-pane fade" id="credit" role="tabpanel" aria-labelledby="credit-tab">
                            <div class="row">
                                <div class="col-sm-6 card shadow-sm mb-3 rounded px-2">
                                    <div class="card-body">
                                        <h5 class="card-title mb-2 fw-semibold text-primary-emphasis"
                                            style="font-size: 1rem;">
                                            EliteTrust-Bank<sup>Â®</sup><span
                                                class="badge bg-light text-dark ms-1">Credit</span>
                                        </h5>
                                        <p class="card-text"><strong>Account Number:</strong>
                                            <% const creditsAccount=account.find(acc=> acc.accountType === "credit"); %>
                                                <%= creditsAccount ? creditsAccount.accountNumber : "No credits account"
                                                    %>
                                        </p>
                                        <p class="card-text"><strong>Available Balance:</strong>
                                            <% const creditsAccountBal=account.find(acc=> acc.accountType === "credit");
                                                %>
                                                $<%= creditsAccountBal ? creditsAccountBal.balance.toFixed(2) : "0.00"
                                                    %>
                                        </p>
                                        <p class="card-text"><strong>Recent Transaction:</strong>
                                            <%= latestCreditTx && latestCreditTx.remarks && latestCreditTx.amount ?
                                                latestCreditTx.remarks + ' -$' + latestCreditTx.amount.toFixed(2)
                                                : " N/A" %>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-sm-6 card shadow-sm mb-3 border-0 rounded-0" style="height: auto;">
                                    <div class="card-body">
                                        <!-- <h5 class="card-title">Bank of America Checking</h5> -->
                                        <!-- <p class="card-text fw-bold ms-1">Customized Cash Rewards</p> -->
                                        <img src="/images/cropped1.png" alt="" class="img-fluid w-50 rounded">
                                        <!-- <p class="ms-1"><span style="color: red;">$200</span> online bonus offer</p> -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Transaction History Section -->
                    <div class="mt-5">
                        <h4 class="mb-4 fw-bold text-secondary"
                            style="font-size: 1.25rem; letter-spacing: 0.3px; margin-top: 12px;">
                            <i class="fas fa-receipt me-2 text-muted"></i>Recent Transactions
                        </h4>
                        <% if (transactions.length> 0) { %>
                            <div class="card shadow-sm">
                                <div class="card-body p-0">
                                    <!-- Entries per page selector -->
                                    <div class="d-flex justify-content-between align-items-center m-2">
                                        <label class="mb-0">
                                            Show
                                            <select id="entriesPerPage"
                                                class="form-select form-select-sm d-inline-block w-auto mx-1">
                                                <option value="2">2</option>
                                                <option value="5" selected>5</option>
                                                <option value="10">10</option>
                                                <option value="All">All</option>
                                            </select>
                                            entries
                                        </label>
                                    </div>

                                    <!-- Table -->
                                    <div class="table-responsive">
                                        <table class="table table-hover table-bordered align-middle"
                                            id="transactionTable">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Description</th>
                                                    <th>Type</th>
                                                    <th class="text-end">Account</th>
                                                    <th class="text-end">Amount</th>
                                                    <th class="text-end">Balance</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Add more rows here as needed -->
                                                <% transactions && transactions.forEach(transaction=> { %>
                                                    <tr>
                                                        <% userAccount=account.find(acc=> acc.accountNumber ===
                                                            transaction.fromAccount); %>
                                                            <!-- <td><%= transaction.createdAt %></td> -->
                                                            <td>
                                                                <%= new
                                                                    Date(transaction.createdAt).toLocaleString('en-US',{
                                                                    year: 'numeric' , month: 'short' , day: 'numeric' ,
                                                                    hour: '2-digit' , minute: '2-digit' }) %>
                                                            </td>
                                                            <td>
                                                                <%= transaction.remarks || 'No remarks' %>
                                                            </td>
                                                            <td>
                                                                <% if (transaction.transactionType=='transfer' ) { %>
                                                                    <span class="badge bg-danger">
                                                                        <%= transaction.transactionType %>
                                                                    </span>
                                                                    <% } else if (transaction.transactionType=='deposit'
                                                                        ) {%>
                                                                        <span class="badge bg-success">
                                                                            <%= transaction.transactionType %>
                                                                        </span>
                                                                        <% } else { %>
                                                                            <span class="badge bg-secondary">
                                                                                <%= transaction.transactionType %>
                                                                            </span>
                                                                            <% } %>
                                                            </td>
                                                            <td class="text-end">
                                                                <%= userAccount.accountType %>
                                                            </td>
                                                            <td class="text-end text-danger">- $<%=
                                                                    transaction.amount.toFixed(2) %>
                                                            </td>
                                                            <td class="text-end">
                                                                <%= userAccount ? '$' + userAccount.balance.toFixed(2)
                                                                    : 'N/A' %>
                                                            </td>
                                                            <td>
                                                                <% if (transaction.status=='pending' ) { %><span
                                                                        class="badge bg-warning">
                                                                        <%= transaction.status %>
                                                                    </span>
                                                                    <% } else if (transaction.status=='completed' ) { %>
                                                                        <span class="badge bg-primary">
                                                                            <%= transaction.status %>
                                                                        </span>
                                                                        <% } else { %><span class="badge bg-secondary">
                                                                                <%= transaction.status %>
                                                                            </span>
                                                                            <% } %>
                                                            </td>
                                                    </tr>
                                                    <% }) %>
                                                        <!-- Add more rows for testing pagination -->
                                            </tbody>
                                        </table>
                                    </div>

                                    <!-- Pagination -->
                                    <nav>
                                        <ul class="pagination justify-content-end mt-3" id="paginationContainer">
                                            <!-- Pagination buttons inserted by JS -->
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                            <% } else { %>
                                <hr>
                                <div class="text-muted">
                                    <i class="fas fa-folder-open fa-2x mb-2"></i>
                                    <h5 class="mb-1">No Transactions Found</h5>
                                    <p class="small">You havenâ€™t recorded any transactions yet.</p>
                                </div>
                                <% } %>
                    </div>
                </div>

                <!-- Transfer Payment -->
                <div id="transfer-view" class="container-fluid border rounded p-4" style="display: none;">
                    <div class="row">
                        <div class="col-12">
                            <!-- Alert on transaction amount validation -->
                            <div id="transferAlert" class="alert alert-warning alert-dismissible fade show d-none"
                                role="alert">
                                <strong>Insufficient Funds:</strong> You cannot transfer amount greater than your
                                current balance.
                                <button id="transerAlertCloseBtn" type="button" class="btn-close"
                                    aria-label="Close"></button>
                            </div>
                            <!-- Form header -->
                            <h4 class="mb-4 fw-bold text-secondary"
                                style="font-size: 1.25rem; letter-spacing: 0.3px; margin-top: 12px;">
                                <i class="fas fa-money-check-alt me-2 text-muted"></i>Online-Bank Transfer
                            </h4>
                            <hr>
                            <!-- Transfer Form -->
                            <form id="transferForm">
                                <div class="row mb-3">
                                    <div class="col-md-6 mb-1">
                                        <label class="form-label d-block text-muted"><strong>Transfer
                                                Type</strong></label>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="transferType"
                                                id="domesticTransfer" value="domestic" checked>
                                            <label class="form-check-label" for="domesticTransfer">Domestic
                                                Transfer</label>
                                        </div>

                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="transferType"
                                                id="internationalTransfer" value="international">
                                            <label class="form-check-label" for="internationalTransfer">International
                                                Transfer</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="transactionType" class="form-label"><small>Transaction
                                                Type</small></label>
                                        <select class="form-select" id="transactionType" name="transactionType"
                                            required>
                                            <option selected disabled value="">Choose...</option>
                                            <option value="transfer">Transfer</option>
                                            <option value="deposit">Deposit</option>
                                            <option value="withdrawal">Withdrawal</option>
                                        </select>
                                    </div>

                                    <div class="col-md-6">
                                        <label for="transferFromAccount" class="form-label"><small>From
                                                Account</small></label>
                                        <select class="form-select" id="transferFromAccount" name="transferFromAccount"
                                            required>
                                            <option selected disabled value="">Choose...</option>
                                            <script>
                                                let accounts;
                                            </script>
                                            <% user.accounts.forEach(account=> { %>
                                                <option value="<%= account.accountType %>">
                                                    <%= account.accountType.charAt(0).toUpperCase() +
                                                        account.accountType.slice(1) %> - <%= account.accountNumber %>
                                                </option>
                                                <script>
                                                    accounts = <%- JSON.stringify(user.accounts); %>
                                                </script>
                                                <% }) %>
                                        </select>
                                        <!-- Hidden input for server side from account number -->
                                        <input type="hidden" name="fromAccountNumberHiddenField"
                                            id="fromAccountNumberHiddenField">
                                    </div>

                                    <div class="col-md-6">
                                        <label for="recipient" class="form-label"><small>Recipient
                                                Account</small></label>
                                        <input type="text" class="form-control" id="recipient" name="recipient"
                                            placeholder="EX. 9876543210" required>
                                    </div>

                                    <div class="col-md-6" id="internationalFields" style="display: none;">
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <label for="iban" class="form-label"><small>IBAN/SWIFT
                                                        Code</small></label>
                                                <input type="text" class="form-control" id="iban" name="ibanOrSwift"
                                                    placeholder="EX. DE89370400440532013000">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <label for="amount" class="form-label"><small>Amount</small></label>
                                        <input type="number" class="form-control" id="amount" name="amount"
                                            placeholder="$0.00" min="1" required>
                                        <small id="displayAccBal" class="text-muted"></small>
                                    </div>

                                    <div class="col-md-6">
                                        <label for="bank" class="form-label"><small>Recipient Bank</small></label>
                                        <select class="form-select" id="bank" name="recipientBank" required>
                                            <option selected disabled value="">Choose...</option>
                                            <option value="boa">Bank of America</option>
                                            <option value="chase">Chase Bank</option>
                                            <option value="wells">Wells Fargo</option>
                                            <option value="capone">Capital One</option>
                                            <option value="ELT-Bank">EliteTrust-Bank</option>
                                            <option value="citi">Citibank</option>
                                            <option value="usbank">U.S. Bank</option>
                                            <option value="pncbank">PNC Bank</option>
                                            <option value="tdbank">TD Bank</option>
                                            <option value="truist">Truist Bank</option>
                                            <option value="ally">Ally Bank</option>
                                            <option value="regions">Regions Bank</option>
                                            <option value="huntington">Huntington Bank</option>
                                            <option value="keybank">KeyBank</option>
                                            <option value="fifththird">Fifth Third Bank</option>
                                            <option value="m&t">M&T Bank</option>
                                            <option value="citizens">Citizens Bank</option>
                                            <option value="bmo">BMO Harris Bank</option>
                                            <option value="santander">Santander Bank</option>
                                            <option value="zions">Zions Bank</option>
                                            <option value="synovus">Synovus Bank</option>
                                            <option value="sofi">SoFi Bank</option>
                                            <option value="chime">Chime</option>
                                            <option value="varo">Varo Bank</option>
                                            <option value="go2bank">GO2bank</option>
                                            <option value="axos">Axos Bank</option>
                                            <option value="nbkc">NBKC Bank</option>
                                            <option value="navyfcu">Navy Federal Credit Union</option>
                                            <option value="pentagonfcu">PenFed Credit Union</option>
                                            <option value="alliant">Alliant Credit Union</option>
                                            <option value="bethpage">Bethpage Federal Credit Union</option>
                                            <option value="schoolsfirst">SchoolsFirst FCU</option>
                                            <option value="stateemployees">State Employees' Credit Union</option>
                                            <option value="wingsfcu">Wings Financial Credit Union</option>
                                            <option value="america1">America First Credit Union</option>
                                            <option value="logix">Logix Federal Credit Union</option>
                                            <option value="towerfcu">Tower Federal Credit Union</option>
                                            <option value="goldmansachs">Goldman Sachs (Marcus)</option>
                                            <option value="morganstanley">Morgan Stanley</option>
                                            <option value="charlesschwab">Charles Schwab Bank</option>
                                            <option value="firstrepublic">First Republic Bank</option>
                                            <option value="flagstar">Flagstar Bank</option>
                                            <option value="comerica">Comerica Bank</option>
                                            <option value="southstate">SouthState Bank</option>
                                        </select>
                                    </div>

                                    <div class="col-md-6" id="routingField">
                                        <label for="routing-number" class="form-label"><small>Routing
                                                Number</small></label>
                                        <input type="text" class="form-control" id="routing-number" name="routingNumber"
                                            placeholder="EX.43454646" min="1">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="remarks" class="form-label"><small>Remarks / Purpose</small></label>
                                        <input type="text" class="form-control" id="remarks" name="remarks"
                                            placeholder="EX.Rent Payment, Invoice #123..." min="1">
                                    </div>

                                    <p class="important">
                                        <strong class="text-danger">Important Notice:</strong> Please allow 5 business
                                        days for international payment processing. Payments updates will be sent via
                                        your registered email with <span>EliteTrust-Bank<sup>Â®</sup></span><br>
                                        <a href="#">Bill Payer Cut-off Information</a>
                                        &nbsp;|&nbsp;
                                        <a href="#">Calculate Total</a>
                                    </p>

                                    <div class="col-12 d-grid">
                                        <button type="submit" class="btn btn-primary">Transfer</button>
                                    </div>

                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Transfer Progress Modal -->
                    <div class="modal fade" id="transferProgressModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content text-center p-4">
                                <div id="progressAnimation" class="mb-3">
                                    <div id="loadingSpinner" class="spinner-border text-primary mb-2" role="status">
                                    </div>
                                    <div class="progress mt-2">
                                        <div id="transferProgressBar"
                                            class="progress-bar progress-bar-striped progress-bar-animated bg-primary"
                                            style="width: 0%;">0%</div>
                                    </div>
                                </div>

                                <div id="otpSection" class="d-none">
                                    <h5 id="otpSectionHeading">Verification Required</h5>
                                    <p>Enter your <strong id="otpSectionCodeName">Secure Code</strong> to continue</p>
                                    <input type="text" id="otpCode" class="form-control mb-3"
                                        placeholder="Enter Code" />
                                    <button id="submitOtpBtn" class="btn btn-success">Submit</button>
                                </div>

                                <div id="transferComplete" class="d-none">
                                    <h5 class="text-success">Transfer Completed Successfully</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Pay -->
                <div id="quickpay-view" class="container-fluid border rounded p-4" style="display: none;">
                    <h4 class="mb-4 fw-bold text-secondary"
                        style="font-size: 1.25rem; letter-spacing: 0.3px; margin-top: 12px;">
                        <i class="fas fa-bolt me-2 text-muted"></i>Quick Pay
                    </h4>
                    <hr>
                    <form class="w-50">
                        <div class="mb-3">
                            <label for="payee" class="form-label"><small>Select Payee</small></label>
                            <select class="form-select" id="payee">
                                <option selected disabled value="">Choose...</option>
                                <optgroup label="Utilities">
                                    <option>Electric Company</option>
                                    <option>Water Company</option>
                                    <option>Natural Gas Provider</option>
                                    <option>Trash Collection Service</option>
                                    <option>Internet Service Provider</option>
                                    <option>Cable TV Provider</option>
                                    <option>Mobile Phone Provider</option>
                                    <option>Landline Phone Provider</option>
                                </optgroup>

                                <optgroup label="Loans & Credit">
                                    <option>Credit Card</option>
                                    <option>Auto Loan</option>
                                    <option>Mortgage Loan</option>
                                    <option>Student Loan</option>
                                    <option>College Loan Servicer</option>
                                    <option>Energy Efficient Upgrade Loan</option>
                                    <option>Car Lease Payment</option>
                                    <option>Loan from Friends/Family</option>
                                </optgroup>

                                <optgroup label="Insurance">
                                    <option>Auto Insurance</option>
                                    <option>Health Insurance</option>
                                    <option>Life Insurance</option>
                                    <option>Homeowners Insurance</option>
                                    <option>Pet Insurance</option>
                                </optgroup>

                                <optgroup label="Housing & Rent">
                                    <option>Rent Payment</option>
                                    <option>Property Tax</option>
                                    <option>HOA Fees</option>
                                    <option>Student Housing</option>
                                    <option>Storage Unit Rental</option>
                                </optgroup>

                                <optgroup label="Education">
                                    <option>School Tuition</option>
                                    <option>Private School Fees</option>
                                    <option>Online Course Platforms</option>
                                </optgroup>

                                <optgroup label="Healthcare">
                                    <option>Medical Bills</option>
                                    <option>Dental Services</option>
                                    <option>Veterinary Bills</option>
                                </optgroup>

                                <optgroup label="Subscriptions & Services">
                                    <option>Streaming Services (Netflix, Hulu, etc.)</option>
                                    <option>Gym Membership</option>
                                    <option>Cloud Storage (iCloud, Google Drive)</option>
                                    <option>Digital Newspaper Subscriptions</option>
                                    <option>Home Security Service</option>
                                    <option>Subscription Services</option>
                                </optgroup>

                                <optgroup label="Government & Legal">
                                    <option>IRS Payment</option>
                                    <option>State Tax Payment</option>
                                    <option>Parking Fees or Fines</option>
                                    <option>Toll Road Payment</option>
                                    <option>Alimony or Child Support</option>
                                </optgroup>

                                <optgroup label="Other">
                                    <option>Charity Donation</option>
                                    <option>Online Shopping (Amazon Pay, PayPal Credit)</option>
                                    <option>Small Business Vendor</option>
                                    <option>Credit Union Payment</option>
                                    <option>Appliance Rental or Financing</option>
                                    <option>Child Care Provider</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="fromAccount" class="form-label"><small>From
                                    Account</small></label>
                            <select class="form-select" id="fromAccount" name="fromAccount" required>
                                <option selected disabled value="">Choose...</option>
                                <!-- <script>
                                    let accounts;
                                </script> -->
                                <% user.accounts.forEach(account=> { %>
                                    <option value="<%= account.accountType %>">
                                        <%= account.accountType.charAt(0).toUpperCase() + account.accountType.slice(1)
                                            %> - <%= account.accountNumber %>
                                    </option>
                                    <!-- <script>
                                    accounts = <%- JSON.stringify(user.accounts); %>
                                </script> -->
                                    <% }) %>
                            </select>
                            <!-- Hidden input for server side from account number -->
                            <!-- <input type="hidden" name="fromAccountNumberHiddenField"
                                id="fromAccountNumberHiddenField"> -->
                        </div>
                        <div class="mb-3">
                            <label for="amount" class="form-label"><small>Amount</small></label>
                            <input type="number" class="form-control" id="quickPayAmount" placeholder="$0.00">
                        </div>
                        <button type="submit" class="btn btn-primary" disabled>Send Payment</button>
                    </form>
                </div>

                <!-- Recurring Payments -->
                <div id="recurring-view" class="container-fluid border rounded p-4" style="display: none;">
                    <h4 class="mb-4 fw-bold text-secondary"
                        style="font-size: 1.25rem; letter-spacing: 0.3px; margin-top: 12px;">
                        <i class="fas fa-sync-alt me-2 text-muted"></i>Recurring Payments
                    </h4>
                    <hr>
                    <p>You have the following recurring payments set up:</p>
                    <ul>
                        <li>No recurring payments set up yet</li>
                        <!-- <li>Gym Membership - $45.00 on the 15th</li> -->
                    </ul>
                </div>

                <!-- Pending Payments -->
                <div id="pending-view" class="container-fluid border rounded p-4" style="display: none;">
                    <h4 class="mb-4 fw-bold text-secondary"
                        style="font-size: 1.25rem; letter-spacing: 0.3px; margin-top: 12px;">
                        <i class="fas fa-clock me-2 text-muted"></i>Pending Payments
                    </h4>
                    <hr>
                    <p>The following payments are scheduled:</p>
                    <ul>
                        <li>There are no pending payments set up yet.</li>
                        <!-- <li>$80.00 to Internet Provider - Scheduled for May 28</li> -->
                    </ul>
                </div>

                <!-- Payment History -->
                <div id="history-view" class="container-fluid border rounded p-4" style="display: none;">
                    <h4 class="mb-4 fw-bold text-secondary"
                        style="font-size: 1.25rem; letter-spacing: 0.3px; margin-top: 12px;">
                        <i class="fas fa-file-invoice-dollar me-2 text-muted"></i>Payment History
                    </h4>
                    <!-- <hr> -->
                    <!-- Entries per page selector -->
                    <% if (transactions.length> 0) { %>
                        <div class="d-flex justify-content-between align-items-center m-2">
                            <label class="mb-0">
                                Show
                                <select id="historyEntriesPerPage"
                                    class="form-select form-select-sm d-inline-block w-auto mx-1">
                                    <option value="2">2</option>
                                    <option value="5" selected>5</option>
                                    <option value="10">10</option>
                                    <option value="All">All</option>
                                </select>
                                entries
                            </label>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover table-bordered align-middle" id="historyTransactionTable">
                                <thead class="table-light">
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th>Type</th>
                                        <th class="text-end">Account</th>
                                        <th class="text-end">Amount</th>
                                        <th class="text-end">Balance</th>
                                        <th class="text-center">Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Add more rows here as needed -->
                                    <% transactions && transactions.forEach(transaction=> { %>
                                        <tr>
                                            <% userAccount=account.find(acc=> acc.accountNumber ===
                                                transaction.fromAccount); %>
                                                <!-- <td><%= transaction.createdAt %></td> -->
                                                <td>
                                                    <%= new Date(transaction.createdAt).toLocaleString('en-US',{
                                                        year: 'numeric' , month: 'short' , day: 'numeric' ,
                                                        hour: '2-digit' , minute: '2-digit' }) %>
                                                </td>
                                                <td>
                                                    <%= transaction.remarks || 'No remarks' %>
                                                </td>
                                                <td>
                                                    <% if (transaction.transactionType=='transfer' ) { %>
                                                        <span class="badge bg-danger">
                                                            <%= transaction.transactionType %>
                                                        </span>
                                                        <% } else if (transaction.transactionType=='deposit' ) {%>
                                                            <span class="badge bg-success">
                                                                <%= transaction.transactionType %>
                                                            </span>
                                                            <% } else { %>
                                                                <span class="badge bg-secondary">
                                                                    <%= transaction.transactionType %>
                                                                </span>
                                                                <% } %>
                                                </td>
                                                <td class="text-end">
                                                    <%= userAccount.accountType %>
                                                </td>
                                                <td class="text-end text-danger">- $<%= transaction.amount.toFixed(2) %>
                                                </td>
                                                <td class="text-end">
                                                    <%= userAccount ? '$' + userAccount.balance.toFixed(2) : 'N/A' %>
                                                </td>
                                                <td class="text-center">
                                                    <% if (transaction.status=='pending' ) { %><span
                                                            class="badge bg-warning">
                                                            <%= transaction.status %>
                                                        </span>
                                                        <% } else if (transaction.status=='completed' ) { %><span
                                                                class="badge bg-primary">
                                                                <%= transaction.status %>
                                                            </span>
                                                            <% } else { %><span class="badge bg-secondary">
                                                                    <%= transaction.status %>
                                                                </span>
                                                                <% } %>
                                                </td>
                                                <td class="text-center">
                                                    <a href="#" data-bs-toggle="modal"
                                                        data-bs-target="#transactionDeleteModal-<%= transaction._id %>">
                                                        <i class="fas fa-trash text-danger"></i>
                                                    </a>
                                                </td>

                                                <!-- Delete Modal -->
                                                <div class="modal fade"
                                                    id="transactionDeleteModal-<%= transaction._id %>" tabindex="-1"
                                                    aria-labelledby="transactionDeleteLabel-<%= transaction._id %>"
                                                    aria-hidden="true">
                                                    <div class="modal-dialog modal-dialog-centered">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h1 class="modal-title fs-5">Delete Transaction</h1>
                                                                <button type="button" class="btn-close"
                                                                    data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <!-- Alert -->
                                                                <div id="deleteTransactionAlert-<%= transaction._id %>"
                                                                    class="alert alert-warning alert-dismissible fade show d-none"
                                                                    role="alert">
                                                                    <strong
                                                                        id="deleteTransactionAlertStatus-<%= transaction._id %>"></strong>
                                                                    <span
                                                                        id="deleteTransactionAlertMessage-<%= transaction._id %>"></span>
                                                                    <button type="button" class="btn" aria-label="Close"
                                                                        onclick="this.parentElement.classList.add('d-none')"></button>
                                                                </div>
                                                                Are you sure you want to delete this transaction from
                                                                history? This action cannot be undone.
                                                            </div>
                                                            <div class="modal-footer">
                                                                <form class="deleteTransactionForm"
                                                                    data-transaction-id="<%= transaction._id %>"
                                                                    action="<%= config.siteUrl %>/user/account/history/delete/<%= transaction._id %>?_method=DELETE">
                                                                    <button type="button" class="btn btn-secondary"
                                                                        data-bs-dismiss="modal">Cancel</button>
                                                                    <button type="submit"
                                                                        class="btn btn-danger">Delete</button>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                        </tr>
                                        <% }) %>
                                            <!-- Add more rows for testing pagination -->
                                </tbody>
                            </table>
                        </div>
                        <% } else { %>
                            <hr>
                            <div class="text-muted">
                                <i class="fas fa-folder-open fa-2x mb-2"></i>
                                <h5 class="mb-1">No Transactions Found</h5>
                                <p class="small">You havenâ€™t recorded any transactions yet.</p>
                            </div>
                            <% } %>
                </div>

                <!-- Add Merchant -->
                <div id="add-merchant-view" class="container-fluid border rounded p-4" style="display: none;">
                    <h4 class="mb-4 fw-bold text-secondary"
                        style="font-size: 1.25rem; letter-spacing: 0.3px; margin-top: 12px;">
                        <i class="fas fa-user-plus me-2 text-muted"></i>Add Merchant/Payee
                    </h4>
                    <hr>
                    <form class="w-50">
                        <div class="mb-3">
                            <label for="merchant-name" class="form-label">Merchant Name</label>
                            <input type="text" class="form-control" id="merchant-name">
                        </div>
                        <div class="mb-3">
                            <label for="account-number" class="form-label">Account Number</label>
                            <input type="text" class="form-control" id="account-number">
                        </div>
                        <button type="submit" class="btn btn-success" disabled>Add Merchant</button>
                    </form>
                </div>

                <!-- Delete Merchant -->
                <div id="delete-merchant-view" class="container-fluid border rounded p-4" style="display: none;">
                    <h4 class="mb-4 fw-bold text-secondary"
                        style="font-size: 1.25rem; letter-spacing: 0.3px; margin-top: 12px;">
                        <i class="fas fa-user-minus me-2 text-muted"></i>Delete Merchant
                    </h4>
                    <hr>
                    <p>Select a merchant to remove:</p>
                    <ul class="list-group w-50">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Electric Company
                            <button class="btn btn-sm btn-danger" disabled>Delete</button>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Water Company
                            <button class="btn btn-sm btn-danger" disabled>Delete</button>
                        </li>
                    </ul>
                </div>

                <!-- Customer Service -->
                <div id="customer-service-view" class="container-fluid border rounded p-4" style="display: none;">
                    <h4 class="mb-4 fw-bold text-secondary"
                        style="font-size: 1.25rem; letter-spacing: 0.3px; margin-top: 12px;">
                        <i class="fas fa-headset me-2 text-muted"></i>Customer Service
                    </h4>
                    <hr>
                    <p>If you need help, please contact our support team:</p>
                    <ul class="w-50 mt-3">
                        <li>Email: <%= config.customerCareEmail %>
                        </li>
                        <li>Phone: <%= config.customerServicePhoneNumber %>
                        </li>
                        <li>Live Chat: Available 24/7</li>
                    </ul>
                </div>

                <!-- Profile -->
                <div id="profile-view" class="container-fluid border rounded p-4" style="display: none;">
                    <h4 class="mb-4 fw-bold text-secondary"
                        style="font-size: 1.25rem; letter-spacing: 0.3px; margin-top: 12px;">
                        <i class="fas fa-user-cog me-2 text-muted"></i>Profile View
                    </h4>
                    <hr>
                    <div class="row mt-4 pt-2">
                        <div class="col-md-4 mb-5 h-100 p-3">
                            <div class="row">
                                <div class="col-12 text-center p-3 border rounded shadow-sm">
                                    <img src="<%= user.imageUrl || '/images/av1.png' %>" class="rounded-circle mb-3"
                                        alt="Profile Picture"
                                        style="width: 120px; height: 120px; object-fit: cover; border: 3px solid #0d6efd;">
                                    <!-- <img src="/images/profile1.jpg" class="rounded-circle mb-3" alt="Profile Picture" style="width: 120px; height: 120px; object-fit: cover; border: 3px solid #0d6efd;"> -->

                                    <h5 class="mb-1">
                                        <%= user.fullName %>
                                    </h5>
                                    <p class="text-muted small mb-2">Passport #.: <%= user.passportNumber %>
                                    </p>

                                    <div class="d-grid gap-2 col-8 p-4 mx-auto">
                                        <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                            data-bs-target="#edit-profile">
                                            Edit Profile
                                        </button>
                                    </div>
                                </div>
                                <!-- Edit Modal -->
                                <!-- <div class="modal fade" id="edit-profile" tabindex="-1" aria-labelledby="edit-profileModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                            <h5 class="modal-title" id="edit-profileModalLabel">Modal title</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                            </div>
                                            <div class="modal-body">
                                                <form id="updateUser" action="/user/account/profile-update?_method=PUT">
                                                    <div class="form-group">
                                                        <label for="editEmail" class="col-form-label">Email:</label>
                                                        <input type="text" value="<%= user.email %>" class="form-control text-muted" id="editEmail" readonly>
                                                    </div>
                                                    <div class="form-group">
                                                      <label for="editFullname" class="col-form-label">Full Name:</label>
                                                      <input type="text" value="<%= user.fullName %>" name="editFullname" class="form-control" id="editFullname">
                                                    </div>
                                                      <div class="form-group">
                                                        <label for="editPhoneNumber" class="col-form-label">Phone Number:</label>
                                                        <input type="text" value="<%= user.phoneNumber %>" name="editPhoneNumber" class="form-control" id="editPhoneNumber">
                                                      </div>
                                                      <div class="modal-footer">
                                                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                      <button type="submit" class="btn btn-primary">Save changes</button>
                                                      </div>
                                                </form>
                                              </div>
                                        </div>
                                        </div>
                                    </div> -->
                                <!-- Modal -->
                                <div class="modal fade" id="edit-profile" tabindex="-1"
                                    aria-labelledby="edit-profileModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h1 class="modal-title fs-5" id="edit-profileModalLabel">Edit Profile
                                                </h1>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <!-- Alert on user profile update -->
                                                <div id="userProfileUpdateAlert"
                                                    class="alert alert-warning alert-dismissible fade show d-none"
                                                    role="alert">
                                                    <strong id="userProfileUpdateAlertStatus"></strong>
                                                    <span id="userProfileUpdateAlertMessage"></span>
                                                    <button id="userProfileUpdateAlertButton" type="button"
                                                        class="btn-close" aria-label="Close"></button>
                                                </div>

                                                <form id="UpdateProfileForm"
                                                    action="<%= config.siteUrl %>/user/account/profile-update?_method=PUT">
                                                    <div class="mb-2">
                                                        <label for="editEmail" class="col-form-label">Email:</label>
                                                        <input type="email" value="<%= user.email %>"
                                                            class="form-control" id="editEmail" disabled>
                                                    </div>
                                                    <div class="mb-2">
                                                        <label for="editPassword" class="col-form-label">Update Password
                                                            (Optional):</label>
                                                        <input type="text" class="form-control" id="editPassword"
                                                            placeholder="Enter your new password" name="editPassword">
                                                    </div>
                                                    <div class="mb-2">
                                                        <label for="editFullName" class="col-form-label">Full
                                                            Name:</label>
                                                        <input type="text" value="<%= user.fullName %>"
                                                            class="form-control" id="editFullName" name="editFullName">
                                                    </div>
                                                    <div class="mb-2">
                                                        <label for="editAddress" class="col-form-label">Address:</label>
                                                        <input type="text" value="<%= user.address %>"
                                                            class="form-control" id="editAddress" name="editAddress">
                                                    </div>
                                                    <div class="mb-2">
                                                        <label for="editPhoneNumber" class="col-form-label">Phone
                                                            Number:</label>
                                                        <input type="text" value="<%= user.phoneNumber %>"
                                                            class="form-control" id="editPhoneNumber"
                                                            name="editPhoneNumber">
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Close</button>
                                                        <button type="submit" class="btn btn-primary">Save
                                                            settings</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right profile data -->
                        <div class="col-md-8 rounded h-100 mt-3">
                            <h5 class="mb-1 border-bottom pb-2"><span class="ms-3">Customer Details</span></h5>

                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <div class="row">
                                        <div class="col-sm-4 fw-bold text-muted">Email:</div>
                                        <div class="col-sm-8">
                                            <%= user.email %>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item">
                                    <div class="row">
                                        <div class="col-sm-4 fw-bold text-muted">Phone:</div>
                                        <div class="col-sm-8">
                                            <%= user.phoneNumber %>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item">
                                    <div class="row">
                                        <div class="col-sm-4 fw-bold text-muted">Address:</div>
                                        <div class="col-sm-8">
                                            <%= user.address %>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item">
                                    <div class="row">
                                        <div class="col-sm-4 fw-bold text-muted">Accounts Owned:</div>
                                        <div class="col-sm-8">
                                            <%= user.accounts? user.accounts.length : 0 %>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item">
                                    <div class="row">
                                        <div class="col-sm-4 fw-bold text-muted">Created On:</div>
                                        <div class="col-sm-8">
                                            <%= user.createdAt.toLocaleString() %>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item">
                                    <div class="row">
                                        <div class="col-sm-4 fw-bold text-muted">Last Login:</div>
                                        <div class="col-sm-8">
                                            <%= user.lastLogin.toLocaleString() %>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item">
                                    <div class="row">
                                        <div class="col-sm-4 fw-bold text-muted">Status:</div>
                                        <div class="col-sm-8">
                                            <%= user.status %>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Remove default bootstrap close modal behavioue -->
    <script>
            // Closes the Alert on click
            document.getElementById("userProfileUpdateAlertButton").addEventListener("click", () => {
                document.getElementById("userProfileUpdateAlert").classList.add("d-none");
            });
    </script>

    <!-- Make .env variables available via middleware in server.js -->
    <script>
        const config = {
            siteUrl: "<%= config.siteUrl %>"
        };
        //   console.log("Config in js script from .env = ", config);
    </script>

    <!-- Tab view Switching -->
    <script>
        function switchView(view) {
            // Hide all view sections
            const views = [
                'overview-view',
                'quickpay-view',
                'recurring-view',
                'pending-view',
                'history-view',
                'add-merchant-view',
                'delete-merchant-view',
                'customer-service-view',
                'transfer-view',
                'profile-view'
            ];
            views.forEach(v => document.getElementById(v).style.display = 'none');

            // Show selected view
            document.getElementById(view + '-view').style.display = 'block';

            // Remove 'active' from all sidebar/offcanvas links
            document.querySelectorAll('.sidebar a').forEach(link => link.classList.remove('active'));

            // Add 'active' to all matching view links (both sidebar and offcanvas)
            document.querySelectorAll(`.sidebar a[onclick*="${view}"]`).forEach(link => link.classList.add('active'));
        }

        // Attach event listeners to all sidebar links
        document.querySelectorAll('.sidebar a').forEach(link => {
            link.addEventListener('click', function () {
                // Remove 'active' class from all links
                document.querySelectorAll('.sidebar a').forEach(el => el.classList.remove('active'));
                // Add 'active' to the clicked link
                this.classList.add('active');
            });
        });
    </script>

    <!-- Account Overview Table pagination -->
    <script>
        const table = document.getElementById("transactionTable");
        const rows = table ? Array.from(table.querySelectorAll("tbody tr")) : [];
        const paginationContainer = document.getElementById("paginationContainer");
        const entriesSelect = document.getElementById("entriesPerPage");

        let currentPage = 1;
        let entriesPerPage = parseInt(entriesSelect?.value) || 5;

        function renderPagination(totalPages) {
            if (!paginationContainer) return;
            paginationContainer.innerHTML = "";

            const createPageItem = (label, page, disabled = false, active = false) => {
                const li = document.createElement("li");
                li.className = `page-item${disabled ? ' disabled' : ''}${active ? ' active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#">${label}</a>`;
                li.addEventListener("click", e => {
                    e.preventDefault();
                    if (!disabled && currentPage !== page) {
                        currentPage = page;
                        renderTable();
                    }
                });
                return li;
            };

            const total = Math.ceil(rows.length / entriesPerPage);
            paginationContainer.appendChild(createPageItem("Previous", currentPage - 1, currentPage === 1));

            for (let i = 1; i <= total; i++) {
                paginationContainer.appendChild(createPageItem(i, i, false, currentPage === i));
            }

            paginationContainer.appendChild(createPageItem("Next", currentPage + 1, currentPage === total));
        }

        function renderTable() {
            const start = (currentPage - 1) * entriesPerPage;
            const end = start + entriesPerPage;

            rows.forEach((row, index) => {
                row.style.display = entriesPerPage === "All" ? "" : (index >= start && index < end ? "" : "none");
            });

            if (entriesPerPage === "All") {
                paginationContainer.innerHTML = "";
            } else {
                renderPagination(Math.ceil(rows.length / entriesPerPage));
            }
        }

        if (entriesSelect) {
            entriesSelect.addEventListener("change", () => {
                const val = entriesSelect.value;
                entriesPerPage = val === "All" ? "All" : parseInt(val);
                currentPage = 1;
                renderTable();
            });
        }
        // Initial render
        renderTable();
    </script>

    <!-- Transfer OTP simulation -->
    <script>
        let currentProgress = 0;
        let transactionId;
        let payload;
        let interval;
        let transactionType;
        let currentBalance;
        let transactionAmount;
        let counter = 0;
        // Validate amount before transfer
        const fromAccSelect = document.getElementById("transferFromAccount");
        const otpSectionCodeName = document.getElementById("otpSectionCodeName");

        fromAccSelect.addEventListener("change", function () {
            const selectedAcc = this.value;
            const acc = accounts.find(acc => acc.accountType === selectedAcc);

            if (acc) {
                currentBalance = `${parseFloat(acc.balance).toFixed(2)}`;
                document.getElementById("fromAccountNumberHiddenField").value = acc.accountNumber;
            }
        });

        // Closes the Alert on click
        document.getElementById("transerAlertCloseBtn").addEventListener("click", () => {
            document.getElementById("transferAlert").classList.add("d-none");
        });

        // Submit transfer form
        const form = document.getElementById('transferForm');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            currentProgress = 0;

            const formData = new FormData(form);
            payload = Object.fromEntries(formData.entries());
            transactionType = payload.transactionType;
            transactionAmount = payload.amount;
            // console.log(`In FE, currentBalance = ${currentBalance} & transactionAmount = ${transactionAmount}`);
            // console.log("payload in FE = ", payload);
            // console.log("transactionType in FE = ", transactionType);

            if (parseFloat(currentBalance) > parseFloat(transactionAmount)) {
                document.getElementById("transferAlert").classList.add("d-none");
                const res = await fetch(`${config.siteUrl}/transfer/initiate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                transactionId = data.transactionId;
                // console.log("data.transactionId in FE = ", transactionId);
                // console.log("Calling startProgess in FE");

                startProgress();
                new bootstrap.Modal(document.getElementById('transferProgressModal')).show();
            }

            else {
                document.getElementById("transferAlert").classList.remove("d-none");
                document.getElementById('amount').value = '';
                // form.reset();
                return;
            }
        });

        // function startProgress() {
        function startProgress() {
            interval = setInterval(async () => {
                currentProgress++;
                updateProgress(currentProgress);
                if (currentProgress == 100) {
                    // Sends completed status to backend
                    // console.log("payload in currentProgress >= 100 = ", payload);
                    const completedPayload = {
                        transactionId: transactionId,
                        recipientBank: payload.recipientBank,
                        allOtpsVerification: "completed",
                    };

                    await fetch(`${config.siteUrl}/transfer/complete`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(completedPayload)
                    });
                    clearInterval(interval);
                    // Show success message
                    document.getElementById('transferComplete').classList.remove('d-none');
                    // Stop animations
                    document.getElementById('transferProgressBar').classList.remove('progress-bar-animated');
                    document.getElementById('transferProgressBar').classList.remove('progress-bar-striped');
                    document.getElementById('loadingSpinner').classList.add('d-none');

                    // Automatically close and reset modal after delay
                    setTimeout(() => {
                        // Close the modal
                        const modal = bootstrap.Modal.getInstance(document.getElementById('transferProgressModal'));
                        if (modal) modal.hide();

                        // Reset UI elements for next time
                        document.getElementById('transferComplete').classList.add('d-none');
                        document.getElementById('otpSection').classList.add('d-none');
                        document.getElementById('otpCode').value = '';
                        document.getElementById('transferProgressBar').classList.add('progress-bar-animated', 'progress-bar-striped');
                        document.getElementById('transferProgressBar').classList.remove('bg-success');
                        document.getElementById('transferProgressBar').style.width = '0%';
                        document.getElementById('transferProgressBar').innerText = '0%';
                        document.getElementById('loadingSpinner').classList.remove('d-none');
                        counter = 0;
                        form.reset();
                    }, 2000); // 2-second delay to show success message before closing
                }

                const res = await fetch(`${config.siteUrl}/transfer/checkpoint?transactionId=${transactionId}&percent=${currentProgress}&type=${transactionType}`);
                const json = await res.json();
                // console.log("otpMsgs from BE to FE = ", json.otpMsgs);
                // console.log("otp checkpoint 1 = ", json.checkpoint);

                if (json.requiresOtp) {
                    clearInterval(interval);
                    document.getElementById("otpSectionHeading").textContent = json.otpMsgs[counter] || "OTP required to proceed.";
                    // const otpMessage = json.otpMsgs[checkpointIndex] || "OTP requireeeee to proceed.";
                    // document.getElementById("otpSectionHeading").innerHTML = otpMessage;
                    document.getElementById('otpSection').classList.remove('d-none');
                    document.getElementById('otpCode').dataset.checkpoint = currentProgress;
                    // Stop animation
                    document.getElementById('transferProgressBar').classList.remove('progress-bar-animated');
                    document.getElementById('transferProgressBar').classList.remove('progress-bar-striped');
                    document.getElementById('loadingSpinner').classList.add('d-none');
                    return;
                }
            }, 300);
        }

        function updateProgress(val) {
            const bar = document.getElementById('transferProgressBar');
            bar.style.width = `${val}%`;
            // Text inside the progress bar
            // bar.textContent = `${val}%`;
            bar.textContent = "Transaction in progress";
        }

        // Submit OTP
        const otpBtn = document.getElementById('submitOtpBtn');
        otpBtn.addEventListener('click', async () => {
            const code = document.getElementById('otpCode').value;
            const checkpoint = document.getElementById('otpCode').dataset.checkpoint;
            // const val = document.getElementById('otpCode').value;
            // console.log("FE: document.getElementById('otpCode').dataset.checkpoint = ", checkpoint);
            // console.log("FE: document.getElementById('otpCode').value = ", val);

            const res = await fetch(`${config.siteUrl}/transfer/otp/verify`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    transactionId,
                    code,
                    type: transactionType,
                    percent: checkpoint
                })
            });
            const result = await res.json();

            if (result.success) {
                document.getElementById('otpSection').classList.add('d-none');
                document.getElementById('transferProgressBar').classList.add('progress-bar-animated');
                document.getElementById('transferProgressBar').classList.add('progress-bar-striped');
                // Restart spinner
                document.getElementById('loadingSpinner').classList.remove('d-none');
                counter++;
                startProgress();
            } else {
                counter = 0;
                alert('Invalid OTP');
            }
        });
    </script>

    <!-- Display form fields based on transfer type (Domestic/International) -->
    <script>
        const internationalFields = document.getElementById('internationalFields');
        const transferRadios = document.querySelectorAll('input[name="transferType"]');
        const routingField = document.getElementById('routingField');

        transferRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                if (radio.value === 'international' && radio.checked) {
                    internationalFields.style.display = 'block';
                    routingField.style.display = 'none';

                } else {
                    internationalFields.style.display = 'none';
                    routingField.style.display = 'block';
                }
            });
        });
    </script>

    <!-- Sidebar tooltip script -->
    <script>
        const tooltips = document.querySelectorAll('[data-bs-toggle=\"tooltip\"]');
        tooltips.forEach(el => new bootstrap.Tooltip(el));
    </script>

    <!-- Display available account balance for selected accountType -->
    <script>
        const fromAccountSelect = document.getElementById("transferFromAccount");
        const displayBalance = document.getElementById("displayAccBal");

        fromAccountSelect.addEventListener("change", function () {
            const selectedType = this.value;
            const account = accounts.find(acc => acc.accountType === selectedType);
            // console.log("Account in display balance = ", account);


            if (account) {
                displayBalance.textContent = `Available Balance: $${parseFloat(account.balance).toFixed(2)}`;
            } else {
                displayBalance.textContent = "Available Balance: $0.00";
            }
        });
    </script>

    <!-- Update profile -->
    <script>
        const profileUpdateForm = document.getElementById("UpdateProfileForm");
        const alertBox = document.getElementById("userProfileUpdateAlert");
        const alertStatus = document.getElementById("userProfileUpdateAlertStatus");
        const alertMessage = document.getElementById("userProfileUpdateAlertMessage");

        profileUpdateForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            const formData = new FormData(profileUpdateForm);
            const payload = Object.fromEntries(formData.entries());

            try {
                const res = await fetch(profileUpdateForm.action, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(payload)
                });
                const result = await res.json();
                alertBox.classList.remove("d-none", "alert-danger");
                alertBox.classList.add("alert-success");
                alertStatus.textContent = `${result.status}:`;
                alertMessage.textContent = result.message;
                // console.log("Response in FE from BE update user profile: ", result);
            } catch (error) {
                alertBox.classList.remove("d-none", "alert-success");
                alertBox.classList.add("alert-danger");
                alertStatus.textContent = `${result.status}:`;
                alertMessage.textContent = result.message;
                // console.log("Error occured in updating profile in FE: ", error.message);
            }
        })
    </script>

    <!-- Delete transaction -->
    <script>
        document.querySelectorAll('.deleteTransactionForm').forEach(form => {
            form.addEventListener('submit', async function (e) {
                e.preventDefault();

                const transactionId = this.dataset.transactionId;
                const action = this.getAttribute('action');

                const alertBox = document.getElementById(`deleteTransactionAlert-${transactionId}`);
                const alertStatus = document.getElementById(`deleteTransactionAlertStatus-${transactionId}`);
                const alertMessage = document.getElementById(`deleteTransactionAlertMessage-${transactionId}`);

                try {
                    const res = await fetch(action, {
                        method: "DELETE",
                        headers: {
                            "Content-Type": "application/json"
                        }
                    });

                    const result = await res.json();

                    alertBox.classList.remove("d-none", "alert-danger");
                    alertBox.classList.add("alert-success");
                    alertStatus.textContent = `${result.status}: `;
                    alertMessage.textContent = result.message;

                    // ðŸ§¹ Remove the row from the table
                    const row = document.getElementById(`transactionRow-${transactionId}`);
                    if (row) row.remove();

                    // ðŸ•’ Auto-hide alert
                    setTimeout(() => {
                        alertBox.classList.add("d-none");
                    }, 8000);

                    // ðŸ•“ Close modal after short delay
                    setTimeout(() => {
                        const modal = bootstrap.Modal.getInstance(document.getElementById(`transactionDeleteModal-${transactionId}`));
                        modal.hide();
                    }, 1000);

                } catch (error) {
                    alertBox.classList.remove("d-none", "alert-success");
                    alertBox.classList.add("alert-danger");
                    alertStatus.textContent = `Error: `;
                    alertMessage.textContent = "Failed to delete transaction.";

                    setTimeout(() => {
                        alertBox.classList.add("d-none");
                    }, 5000);
                }
            });
        });
    </script>


</body>

</html>
